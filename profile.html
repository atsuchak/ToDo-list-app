<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Settings | Tasked-Todo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
        }
    </script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --dark-bg: #030303;
            --light-bg: #f8fafc;
        }

        .dark {
            background-color: var(--dark-bg);
            color: #f8fafc;
        }

        .light {
            background-color: var(--light-bg);
            color: #030303;
        }

        body {
            font-family: 'Outfit', sans-serif;
            transition: background 0.4s ease;
            min-height: 100vh;
        }

        /* Glass Slab Design */
        .glass-slab {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .dark .glass-slab {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.06);
            box-shadow: none;
        }

        .glass-input {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: #0f172a;
            transition: all 0.3s ease;
        }

        .dark .glass-input {
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.08);
            color: white;
        }

        .glass-input:focus {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(59, 130, 246, 0.5);
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .dark .glass-input:focus {
            background: rgba(0, 0, 0, 0.4);
            box-shadow: none;
        }

        /* Avatar Hover Effect */
        .avatar-container:hover .avatar-overlay {
            opacity: 1;
        }

        /* Danger Zone Pattern */
        .danger-pattern {
            background-image: repeating-linear-gradient(45deg, rgba(239, 68, 68, 0.05) 0px, rgba(239, 68, 68, 0.05) 10px, transparent 10px, transparent 20px);
        }

        /* Tab Animation */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease forwards;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .tab-btn.active {
            background: rgba(255, 255, 255, 0.08);
            border-left: 3px solid #3b82f6;
            color: #fff;
        }

        .light .tab-btn.active {
            background: rgba(0, 0, 0, 0.05);
            color: #0f172a;
            /* Slate 900 */
        }
    </style>
</head>

<body class="p-6 md:p-12 text-slate-800 dark:text-slate-300">
    <div id="notification-container" class="fixed top-4 right-4 z-[100] flex flex-col gap-3 pointer-events-none"></div>

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex items-center justify-between mb-10">
            <button onclick="window.location.href='index.html'"
                class="group flex items-center gap-3 px-4 py-2 rounded-full glass-slab hover:bg-white/5 transition-all">
                <i data-lucide="arrow-left"
                    class="w-5 h-5 text-slate-900 dark:text-slate-400 group-hover:text-blue-600 dark:group-hover:text-white transition-colors"></i>
                <span
                    class="text-sm font-medium text-slate-900 dark:text-slate-400 group-hover:text-blue-600 dark:group-hover:text-white transition-colors">Back
                    to
                    Dashboard</span>
            </button>
            <div class="flex items-center gap-3">
                <button onclick="ProfileUI.toggleTheme()"
                    class="p-2 glass-slab rounded-full hover:bg-white/5 transition-all text-slate-800 dark:text-slate-400 hover:text-black dark:hover:text-white">
                    <i data-lucide="moon" id="themeIcon" class="w-5 h-5"></i>
                </button>
                <div class="h-6 w-px bg-white/10 mx-1"></div>
                <div
                    class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-500/20">
                    <i data-lucide="settings-2" class="text-white w-4 h-4"></i>
                </div>
                <h1 class="text-xl font-bold tracking-tight text-slate-900 dark:text-white">User Settings</h1>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">

            <!-- Left Column: Profile Card & Navigation -->
            <div class="lg:col-span-4 space-y-6">
                <!-- Profile Card -->
                <div class="glass-slab rounded-[2rem] p-8 text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-24 bg-gradient-to-b from-blue-600/10 to-transparent">
                    </div>

                    <div class="relative inline-block avatar-container cursor-pointer mb-4"
                        onclick="document.getElementById('avatarUpload').click()">
                        <div
                            class="w-32 h-32 rounded-full border-4 border-white/5 overflow-hidden mx-auto bg-black relative shadow-2xl">
                            <img id="profileAvatar"
                                src="https://ui-avatars.com/api/?name=User&background=0D8ABC&color=fff" alt="Avatar"
                                class="w-full h-full object-cover">
                            <div
                                class="avatar-overlay absolute inset-0 bg-black/60 flex items-center justify-center opacity-0 transition-opacity duration-300">
                                <i data-lucide="camera" class="w-8 h-8 text-white"></i>
                            </div>
                        </div>
                        <input type="file" id="avatarUpload" class="hidden" accept="image/*">
                    </div>

                    <h2 id="profileName" class="text-2xl font-bold text-black dark:text-white mb-1">Loading...</h2>
                    <p id="profileEmail" class="text-sm text-slate-700 dark:text-slate-500 font-mono mb-6">...</p>

                    <div class="grid grid-cols-2 gap-4 border-t border-white/5 pt-6">
                        <div>
                            <p
                                class="text-[10px] uppercase font-bold text-slate-700 dark:text-slate-500 tracking-widest">
                                Tasks</p>
                            <p id="statTasks" class="text-xl font-bold text-black dark:text-white">0</p>
                        </div>
                        <div>
                            <p
                                class="text-[10px] uppercase font-bold text-slate-700 dark:text-slate-500 tracking-widest">
                                Streak</p>
                            <p id="statStreak" class="text-xl font-bold text-blue-600 dark:text-blue-500">0</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation Tabs -->
                <div class="glass-slab rounded-[2rem] p-4 flex flex-col gap-2">
                    <button onclick="ProfileUI.switchTab('general')"
                        class="tab-btn active w-full text-left px-6 py-4 rounded-xl text-sm font-medium text-slate-900 dark:text-slate-400 hover:bg-black/5 dark:hover:bg-white/5 transition-all flex items-center gap-3">
                        <i data-lucide="user" class="w-5 h-5"></i> General
                    </button>
                    <button onclick="ProfileUI.switchTab('security')"
                        class="tab-btn w-full text-left px-6 py-4 rounded-xl text-sm font-medium text-slate-900 dark:text-slate-400 hover:bg-black/5 dark:hover:bg-white/5 transition-all flex items-center gap-3">
                        <i data-lucide="shield" class="w-5 h-5"></i> Security
                    </button>
                    <button onclick="ProfileUI.switchTab('danger')"
                        class="tab-btn w-full text-left px-6 py-4 rounded-xl text-sm font-medium text-slate-900 dark:text-slate-400 hover:bg-red-500/10 hover:text-red-500 dark:hover:text-red-400 transition-all flex items-center gap-3">
                        <i data-lucide="alert-triangle" class="w-5 h-5"></i> Danger Zone
                    </button>

                    <div class="h-px bg-white/5 my-2"></div>

                    <button onclick="Auth.logout()"
                        class="w-full text-left px-6 py-4 rounded-xl text-sm font-medium text-slate-900 dark:text-slate-400 hover:bg-black/5 dark:hover:bg-white/5 hover:text-slate-900 dark:hover:text-white transition-all flex items-center gap-3">
                        <i data-lucide="log-out" class="w-5 h-5"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Right Column: Settings Content -->
            <div class="lg:col-span-8">

                <!-- General Tab -->
                <div id="tab-general" class="tab-content active glass-slab rounded-[2.5rem] p-8 md:p-10 min-h-[500px]">
                    <h3 class="text-2xl font-bold text-slate-900 dark:text-white mb-8">General Information</h3>

                    <form id="generalForm" onsubmit="event.preventDefault(); ProfileAuth.updateGeneral();"
                        class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label
                                    class="text-[11px] font-bold text-slate-900 dark:text-slate-500 uppercase tracking-widest ml-1">Full
                                    Name</label>
                                <input type="text" id="inputName"
                                    class="glass-input w-full px-5 py-4 rounded-xl placeholder:text-slate-500 dark:placeholder:text-slate-600 focus:ring-2 ring-blue-500/50"
                                    placeholder="Your Name">
                            </div>
                            <div class="space-y-2">
                                <label
                                    class="text-[11px] font-bold text-slate-900 dark:text-slate-500 uppercase tracking-widest ml-1">Username</label>
                                <div class="relative">
                                    <span class="absolute left-5 top-4 text-slate-500">@</span>
                                    <input type="text" id="inputUsername"
                                        class="glass-input w-full pl-10 pr-5 py-4 rounded-xl placeholder:text-slate-500 dark:placeholder:text-slate-600 focus:ring-2 ring-blue-500/50"
                                        placeholder="username">
                                    <div id="usernameStatus" class="absolute right-4 top-4"></div>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label
                                    class="text-[11px] font-bold text-slate-900 dark:text-slate-500 uppercase tracking-widest ml-1">Institution
                                    / Company</label>
                                <input type="text" id="inputInstitution"
                                    class="glass-input w-full px-5 py-4 rounded-xl placeholder:text-slate-500 dark:placeholder:text-slate-600 focus:ring-2 ring-blue-500/50"
                                    placeholder="Where do you work?">
                            </div>
                            <div class="space-y-2">
                                <label
                                    class="text-[11px] font-bold text-slate-900 dark:text-slate-500 uppercase tracking-widest ml-1">Age</label>
                                <input type="number" id="inputAge"
                                    class="glass-input w-full px-5 py-4 rounded-xl placeholder:text-slate-500 dark:placeholder:text-slate-600 focus:ring-2 ring-blue-500/50"
                                    placeholder="25">
                            </div>
                        </div>

                        <div class="border-t border-white/5 pt-8 mt-8 flex justify-end gap-4">
                            <button type="button" onclick="ProfileAuth.syncLocalData()"
                                class="px-6 py-3 rounded-xl text-sm font-medium text-slate-700 dark:text-slate-400 hover:text-black dark:hover:text-white hover:bg-white/5 transition-all flex items-center gap-2">
                                <i data-lucide="refresh-cw" class="w-4 h-4"></i> Sync Local Data
                            </button>
                            <button type="submit"
                                class="bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 px-8 rounded-xl shadow-lg shadow-blue-600/20 transition-all transform hover:scale-[1.02] active:scale-95">
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Security Tab -->
                <div id="tab-security" class="tab-content glass-slab rounded-[2.5rem] p-8 md:p-10 min-h-[500px]">
                    <h3 class="text-2xl font-bold text-slate-900 dark:text-white mb-8">Security</h3>

                    <form id="securityForm" onsubmit="event.preventDefault(); ProfileAuth.updatePassword();"
                        class="space-y-6 max-w-md">
                        <div class="space-y-2">
                            <label
                                class="text-[11px] font-bold text-slate-900 dark:text-slate-500 uppercase tracking-widest ml-1">Current
                                Password</label>
                            <div class="relative">
                                <input type="password" id="currentPassword"
                                    class="glass-input w-full px-5 py-4 rounded-xl placeholder:text-slate-500 dark:placeholder:text-slate-600 focus:ring-2 ring-blue-500/50"
                                    placeholder="••••••••">
                                <i data-lucide="lock" class="w-4 h-4 text-slate-500 absolute right-4 top-4.5"></i>
                            </div>
                            <p class="text-xs text-slate-700 dark:text-slate-500 px-1">Required to verify your identity.
                            </p>
                        </div>

                        <div class="space-y-2 border-t border-white/5 pt-6">
                            <label
                                class="text-[11px] font-bold text-slate-900 dark:text-slate-500 uppercase tracking-widest ml-1">New
                                Password</label>
                            <input type="password" id="newPassword"
                                oninput="ProfileUI.checkPasswordStrength(this.value)"
                                class="glass-input w-full px-5 py-4 rounded-xl placeholder:text-slate-500 dark:placeholder:text-slate-600 focus:ring-2 ring-blue-500/50"
                                placeholder="New secure password">

                            <!-- Strength Meter -->
                            <div class="flex gap-1 h-1 mt-2">
                                <div id="strength-1" class="flex-1 rounded-full bg-white/10 transition-colors"></div>
                                <div id="strength-2" class="flex-1 rounded-full bg-white/10 transition-colors"></div>
                                <div id="strength-3" class="flex-1 rounded-full bg-white/10 transition-colors"></div>
                            </div>
                        </div>

                        <div class="pt-4">
                            <button type="submit"
                                class="w-full bg-slate-800 hover:bg-blue-600 text-white font-bold py-4 rounded-xl transition-all shadow-lg">
                                Update Password
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Danger Tab -->
                <div id="tab-danger"
                    class="tab-content glass-slab rounded-[2.5rem] p-8 md:p-10 min-h-[500px] border border-red-500/20 danger-pattern">
                    <h3 class="text-2xl font-bold text-red-500 mb-8 flex items-center gap-3">
                        <i data-lucide="alert-octagon" class="w-8 h-8"></i> Danger Zone
                    </h3>

                    <div class="space-y-6">
                        <div class="glass-input p-6 rounded-2xl border-red-500/10 flex items-center justify-between">
                            <div>
                                <h4 class="text-lg font-bold text-slate-900 dark:text-white">Wipe All Task Data</h4>
                                <p class="text-sm text-slate-700 dark:text-slate-500 mt-1">Permanently remove all tasks
                                    and history. Account
                                    remains active.</p>
                            </div>
                            <button onclick="ProfileAuth.wipeData()"
                                class="px-5 py-3 rounded-xl bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white font-bold transition-all">
                                Wipe Data
                            </button>
                        </div>

                        <div class="glass-input p-6 rounded-2xl border-red-500/10 flex items-center justify-between">
                            <div>
                                <h4 class="text-lg font-bold text-slate-900 dark:text-white">Delete Account</h4>
                                <p class="text-sm text-slate-700 dark:text-slate-500 mt-1">Permanently delete your
                                    account and all
                                    associated data.</p>
                            </div>
                            <button onclick="ProfileAuth.deleteAccount()"
                                class="px-5 py-3 rounded-xl bg-red-600 text-white hover:bg-red-700 font-bold transition-all shadow-lg shadow-red-600/20">
                                Delete Account
                            </button>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

    <script src="auth.js"></script>
    <script src="profile-auth.js"></script>
    <script>
        // Init Icons
        lucide.createIcons();

        // UI Helpers
        const ProfileUI = {
            switchTab(tabName) {
                // Update Buttons
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                event.currentTarget.classList.add('active');

                // Update Content
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.getElementById(`tab-${tabName}`).classList.add('active');
            },

            checkPasswordStrength(password) {
                let strength = 0;
                if (password.length >= 6) strength++;
                if (password.length >= 10 && /[A-Z]/.test(password)) strength++;
                if (/[0-9]/.test(password) && /[^A-Za-z0-9]/.test(password)) strength++;

                const colors = ['bg-red-500', 'bg-yellow-500', 'bg-green-500'];
                const bars = [document.getElementById('strength-1'), document.getElementById('strength-2'), document.getElementById('strength-3')];

                bars.forEach((bar, idx) => {
                    bar.className = `flex-1 rounded-full transition-colors ${idx < strength ? colors[strength - 1] : 'bg-white/10'}`;
                });
            },

            toggleTheme() {
                const stored = localStorage.getItem('flow_os_v3');
                let db = stored ? JSON.parse(stored) : { theme: 'dark' };
                db.theme = db.theme === 'dark' ? 'light' : 'dark';
                localStorage.setItem('flow_os_v3', JSON.stringify(db));
                this.applyTheme();
            },

            applyTheme() {
                const stored = localStorage.getItem('flow_os_v3');
                const db = stored ? JSON.parse(stored) : { theme: 'dark' };
                const isDark = db.theme === 'dark';
                document.documentElement.classList.toggle('dark', isDark);
                document.documentElement.classList.toggle('light', !isDark);

                const icon = document.getElementById('themeIcon');
                if (icon) icon.setAttribute('data-lucide', isDark ? 'moon' : 'sun');
                lucide.createIcons();
            }
        };

        // UI Notification helper (Similar to app.js)
        const UI = {
            showNotification(message, type = "blue") {
                const container = document.getElementById('notification-container');
                let colorClass, iconColor, iconBg, iconName, title;

                switch (type) {
                    case "red":
                        colorClass = "border-red-500"; iconColor = "text-red-400"; iconBg = "bg-red-500/20"; iconName = "alert-circle"; title = "Error"; break;
                    default:
                        colorClass = "border-blue-500"; iconColor = "text-blue-400"; iconBg = "bg-blue-500/20"; iconName = "check-circle-2"; title = "Success";
                }

                const toast = document.createElement('div');
                toast.className = `glass-slab px-6 py-4 rounded-2xl border-l-4 ${colorClass} flex items-center gap-3 shadow-2xl transition-all pointer-events-auto`;
                toast.innerHTML = `
                    <div class="w-8 h-8 ${iconBg} rounded-lg flex items-center justify-center"><i data-lucide="${iconName}" class="w-5 h-5 ${iconColor}"></i></div>
                    <div><p class="text-sm font-bold text-white">${title}</p><p class="text-xs text-slate-400">${message}</p></div>`;

                container.appendChild(toast);
                lucide.createIcons();
                setTimeout(() => toast.remove(), 3000);
            }
        };
    </script>
</body>

</html>